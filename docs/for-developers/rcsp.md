---
layout: documentation
title: Протокол RCSP
show-on-header: false
is-documentation: true
---

## Протокол RCSP
RCSP (Remote Control and Synchronization Protocol) --- бинарный протокол
управления и синхронизации переменных устройств системы Caustic. 

### Использование в системе
RCSP является протоколом уровня представления и используется в системе
для передачи команд по разным каналам:

 - Через радиосвязь
 
 - Через ИК-канал
 
 - Напрямую считывается из файлов на SD-карте
 
 - Считывается с RFID-меток
 
### RCSP-сообщения
Единицей обмена данными через RCSP является сообщение. Сообщения могут
быть объединены в единый бинарный поток. Такой поток не требует дополнительной
метаинформации. Сообщение имеет следующую структуру, последовательно:

| 1 byte | 2 bytes | arg_size bytes |
|:-:|:-:|:-:|
| uint8_t arg_size | uint16_t op_code |  argument |

 - `arg_size` --- размер аргумента операции, принимает значения [0..255]
 - `op_code` --- код операции
 - `argument` --- аргумент операции. Отсутствует, если `arg_size == 0`

Таким образом, `arg_size` и `op_code` составляют заголовок сообщения. 
Поскольку размер сообщения всегда составляет `arg_size + 3` байт, сообщения
с неизвестным кодом операции могут быть пропущены без ущерба для остальных
сообщений, входящих в поток.

Тип операции задается двумя старшими битами `op_code`. Поддерживается 
3 типа операций:

| Тип |     Шаблон      | Операция |
|:---:|:---------------:|:---------|
|Set parameter (SP)     | 01xxxxxxxxxxxxxx| Установить значение некоторой переменной в `argument` |
|Request parameter (RP) | 10xxxxxxxxxxxxxx| Запросить значение переменной |
|Call request (CR)      | 00xxxxxxxxxxxxxx| Вызвать функцию с параметром `argument` |

Запросы значения перенной предполагают отправку ответного пакета и 
используются только для взаимодействия по радиосети.
